<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>StudySphere</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
	<style>
		/* full-viewport background image (fixed for subtle parallax) */
		.bg-image {
		position: fixed;
		inset: 0;
		background-image: url('bg.webp');
		background-size: cover;
		background-position: center;
		background-attachment: fixed;
		z-index: 0;
		will-change: transform;
		transform: none;
		}

		/* black overlay that fades-in as you scroll */
		.bg-overlay {
		position: fixed;
		inset: 0;
		background: #000;
		opacity: 0;
		transition: opacity 200ms linear;
		z-index: 1;
		pointer-events: none;
		}

		/* content sits above the background */
		.cover-container {
		position: relative;
		z-index: 2;
		/* keep min height as before */
		min-height: 100vh;
		background: transparent;
		}

		/* make sure header + main are visible above overlay */
		header, main { position: relative; z-index: 3; }

		/* header starts transparent, becomes more opaque on scroll */
		header.sticky-top {
			background-color: rgba(0,0,0,0);
			backdrop-filter: saturate(120%) blur(0px);
			transition: background-color 200ms linear, backdrop-filter 200ms linear, box-shadow 200ms linear;
		}

		/* small visual tweak so text remains readable on image */
		body[data-bs-theme="dark"] .nav-link { text-shadow: 0 1px 2px rgba(0,0,0,0.6); }

		/* optional: a little parallax move for the image (subtle) */
		.bg-image.parallax {
			transform-origin: center;
		}

		header, main, .cover-hero, .cover-container, .container {
			position: relative; /* z-index only works when positioned */
			z-index: 10;        /* higher than bg/z-overlay */
		}

		/* Responsive tweak so overlay transitions smooth on small screens */
		@media (prefers-reduced-motion: reduce) {
		.bg-overlay { transition: none; }
		.bg-image { transition: none; }
		}

		/* ====== Feedback Scroller ====== */
		.feedback-section {
			position: relative;
			z-index: 10;
		}

		.feedback-scroller {
			overflow: hidden;
			mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
			-webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
		}

		.feedback-track {
			display: flex;
			gap: 1rem;
			width: max-content;
			animation: feedback-scroll 40s linear infinite;
			will-change: transform;
			padding-block: .5rem;
		}

		.feedback-scroller:hover .feedback-track {
			animation-play-state: paused;
		}

		.feedback-card {
			flex: 0 0 auto;
			min-width: 320px;
			max-width: 360px;
			background-color: #000;
		}

		@keyframes feedback-scroll {
			from { transform: translateX(0); }
			to { transform: translateX(-50%); }
		}

		/* ====== Join Count + Wireframe Globe ====== */
		.join-section {
			position: relative;
			z-index: 10;
			min-height: 100vh;
		}

		.globe-wrapper {
			display: flex;
			align-items: center;
			justify-content: center;
			margin-bottom: 1.5rem;
		}

		.globe {
			width: 220px;
			height: 220px;
			border-radius: 50%;
			position: relative;
			background:
				repeating-conic-gradient(from 0deg, rgba(255,255,255,0.15) 0deg 1deg, transparent 1deg 15deg),
				radial-gradient(circle at 50% 50%, rgba(255,255,255,0.08), rgba(0,0,0,0.2) 60%);
			box-shadow: inset 0 0 30px rgba(0,0,0,0.6), 0 0 30px rgba(0,0,0,0.4);
			overflow: hidden;
			animation: globe-spin 24s linear infinite;
		}

		/* latitude lines */
		.globe::before {
			content: "";
			position: absolute;
			inset: 0;
			border-radius: 50%;
			background:
				repeating-radial-gradient(circle at 50% 50%, transparent 0 10px, rgba(255,255,255,0.12) 10px 11px);
			mask-image: radial-gradient(circle at 50% 50%, black 60%, transparent 62%);
			-webkit-mask-image: radial-gradient(circle at 50% 50%, black 60%, transparent 62%);
		}

		/* subtle specular highlight */
		.globe::after {
			content: "";
			position: absolute;
			inset: 0;
			border-radius: 50%;
			background: radial-gradient(circle at 35% 30%, rgba(255,255,255,0.18), transparent 45%);
			pointer-events: none;
		}

		@keyframes globe-spin {
			from { transform: rotate(0deg); }
			to { transform: rotate(360deg); }
		}

		.join-number {
			font-variant-numeric: tabular-nums;
		}
	</style>
</head>
<body class="d-flex flex-column min-vh-100" data-bs-theme="dark">

	<!-- Background layers (fixed, behind everything) -->
	<div class="bg-image" id="bgImage"></div>
	<div class="bg-overlay" id="bgOverlay"></div>

	<header class="p-3 sticky-top">
		<div class="container">
		<div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
			<a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
			<svg class="bi me-2" width="40" height="32" role="img" aria-label="Logo"></svg>
			</a>
			<ul class="nav nav-pills col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
			<li><a href="/" class="nav-link px-3 text-warning">Home</a></li>
			<li><a href="/leaderboard.html" class="nav-link px-3 text-white">Leaderboard</a></li>
			<li><a href="/practice.html" class="nav-link px-3 text-white">Practice</a></li>
			<li><a href="/rank.html" class="nav-link px-3 text-white">Rank</a></li>
			<li><a href="/about.html" class="nav-link px-3 text-white">About</a></li>
			</ul>
			<div class="text-end">
			<a href="/login.html" type="button" class="btn btn-outline-light me-2">Login</a>
			<a href="/signup.html" type="button" class="btn btn-warning">Sign-up</a>
			</div>
		</div>
		</div>
	</header>

	<!-- cover-container fills viewport (min-vh-100) and is a column flexbox -->
	<div class="cover-container d-flex w-100 min-vh-100 p-3 mx-auto flex-column">
		<!-- main area: my-auto centers it vertically inside the column -->
		<main class="px-3 my-auto text-center">
		<h1 class="display-3">Welcome to <span class="text-warning"><strong>StudySphere</strong></span>,</h1>
		<p class="lead"><span class="text-warning">Read</span> More. <span class="text-warning">Learn</span> More. <span class="text-warning">Be</span> More.</p>
		<p class="lead py-3">
			<a href="/signup.html" class="btn btn-lg btn-outline-warning">Join Us</a>
		</p>
		</main>
	</div>
	

	<!-- Feedback Scrolling Cards -->
	<section class="feedback-section py-5">
		<div class="container">
			<h2 class="h3 text-center mb-4">What learners say</h2>
		</div>
		<div class="feedback-scroller">
			<div class="feedback-track">
				<!-- Set A -->
				<div class="card border border-secondary-subtle feedback-card">
					<div class="card-body">
						<p class="card-text">“StudySphere turned my daily commute into a productive study sprint. The practice sets are spot on!”</p>
						<div class="d-flex align-items-center mt-3">
							<img src="https://i.pravatar.cc/40?img=1" class="rounded-circle me-2" width="32" height="32" alt="avatar">
							<div>
								<div class="fw-semibold">Aarav S.</div>
								<div class="text-body-secondary small">B.Tech, 2nd Year</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card border border-secondary-subtle feedback-card">
					<div class="card-body">
						<p class="card-text">“The XP and leaderboard actually keep me motivated. I log in every day now.”</p>
						<div class="d-flex align-items-center mt-3">
							<img src="https://i.pravatar.cc/40?img=2" class="rounded-circle me-2" width="32" height="32" alt="avatar">
							<div>
								<div class="fw-semibold">Maya T.</div>
								<div class="text-body-secondary small">Aspirant</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card border border-secondary-subtle feedback-card">
					<div class="card-body">
						<p class="card-text">“Clean UI, great questions, and instant feedback. Exactly what I needed.”</p>
						<div class="d-flex align-items-center mt-3">
							<img src="https://i.pravatar.cc/40?img=3" class="rounded-circle me-2" width="32" height="32" alt="avatar">
							<div>
								<div class="fw-semibold">Rahul K.</div>
								<div class="text-body-secondary small">Working Professional</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card border border-secondary-subtle feedback-card">
					<div class="card-body">
						<p class="card-text">“Increase my focus and productivity surprisingly.”</p>
						<div class="d-flex align-items-center mt-3">
							<img src="https://i.pravatar.cc/40?img=4" class="rounded-circle me-2" width="32" height="32" alt="avatar">
							<div>
								<div class="fw-semibold">Bhavik R.</div>
								<div class="text-body-secondary small">L.L.B, 1st Year</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Set B (duplicate for seamless loop) -->
				<div class="card border border-secondary-subtle feedback-card">
					<div class="card-body">
						<p class="card-text">“StudySphere turned my daily commute into a productive study sprint. The practice sets are spot on!”</p>
						<div class="d-flex align-items-center mt-3">
							<img src="https://i.pravatar.cc/40?img=1" class="rounded-circle me-2" width="32" height="32" alt="avatar">
							<div>
								<div class="fw-semibold">Aarav S.</div>
								<div class="text-body-secondary small">B.Tech, 2nd Year</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card border border-secondary-subtle feedback-card">
					<div class="card-body">
						<p class="card-text">“The XP and leaderboard actually keep me motivated. I log in every day now.”</p>
						<div class="d-flex align-items-center mt-3">
							<img src="https://i.pravatar.cc/40?img=2" class="rounded-circle me-2" width="32" height="32" alt="avatar">
							<div>
								<div class="fw-semibold">Maya T.</div>
								<div class="text-body-secondary small">Aspirant</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card border border-secondary-subtle feedback-card">
					<div class="card-body">
						<p class="card-text">“Clean UI, great questions, and instant feedback. Exactly what I needed.”</p>
						<div class="d-flex align-items-center mt-3">
							<img src="https://i.pravatar.cc/40?img=3" class="rounded-circle me-2" width="32" height="32" alt="avatar">
							<div>
								<div class="fw-semibold">Rahul K.</div>
								<div class="text-body-secondary small">Working Professional</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card border border-secondary-subtle feedback-card">
					<div class="card-body">
						<p class="card-text">“Increase my focus and productivity surprisingly.”</p>
						<div class="d-flex align-items-center mt-3">
							<img src="https://i.pravatar.cc/40?img=4" class="rounded-circle me-2" width="32" height="32" alt="avatar">
							<div>
								<div class="fw-semibold">Bhavik R.</div>
								<div class="text-body-secondary small">L.L.B, 1st Year</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Join count full-screen section -->
	<section class="join-section d-flex align-items-center justify-content-center py-5">
		<div class="container text-center">
			<div class="globe-wrapper">
				<div id="globeMount" style="width: 100%; max-width: 520px; margin: 0 auto;"></div>
			</div>
			<div class="display-3 fw-bold join-number text-warning" id="joinCounter">12,345</div>
			<p class="lead text-body-secondary mt-2">people have joined us.</p>
		</div>
	</section>

	<div class="container"> 
		<footer class="py-3 my-4"> 
			<ul class="nav justify-content-center border-bottom pb-3 mb-3"> 
				<li class="nav-item"><a href="/" class="nav-link px-2 text-body-secondary">Home</a></li> 
				<li class="nav-item"><a href="/leaderboard.html" class="nav-link px-2 text-body-secondary">Leaderboard</a></li> 
				<li class="nav-item"><a href="/practice.html" class="nav-link px-2 text-body-secondary">Practice</a></li> 
				<li class="nav-item"><a href="/rank.html" class="nav-link px-2 text-body-secondary">Rank</a></li> 
				<li class="nav-item"><a href="/about.html" class="nav-link px-2 text-body-secondary">About</a></li> 
			</ul> 
			<p class="text-center text-body-secondary">© 2025 StudySphere</p> 
		</footer> 
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Supabase JS CDN -->
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
	<!-- Three.js will be loaded via ES modules below -->
	<script>
	// Replace with your Supabase project URL and anon key
	const SUPABASE_URL = 'https://mtrdbguzixngcvzcxwlz.supabase.co';
	const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10cmRiZ3V6aXhuZ2N2emN4d2x6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxMzY1NTIsImV4cCI6MjA3MjcxMjU1Mn0.Bcedj4oZbqY0sWzTXULtPeiPlNDdy2RnVef_u68tHVU';
	const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

	// Helper: get user from localStorage/session
	async function getUser() {
		// Try to get from localStorage (persisted session)
		let user = null;
		try {
		const session = JSON.parse(localStorage.getItem('sb-session'));
		if (session && session.user) user = session.user;
		} catch {}
		// If not found, try Supabase
		if (!user) {
		const { data } = await sb.auth.getUser();
		user = data && data.user;
		}
		return user;
	}

	// On login/signup, save session to localStorage
	sb.auth.onAuthStateChange((event, session) => {
		if (session) {
		localStorage.setItem('sb-session', JSON.stringify(session));
		} else {
		localStorage.removeItem('sb-session');
		}
		updateUserUI();
	});

	// Fetch XP from Supabase 'profiles' table
	async function getUserXP(userId) {
		if (!userId) return null;
		// Assumes a 'profiles' table with 'id' (uuid, matches user.id) and 'xp' (integer)
		const { data, error } = await sb.from('profiles').select('xp').eq('id', userId).single();
		if (error) return null;
		return data?.xp ?? 0;
	}

	// Update UI: replace login/signup with user info and XP if logged in
	async function updateUserUI() {
		const user = await getUser();
		const userDiv = document.querySelector('.text-end');
		if (!userDiv) return;
		if (user) {
			// Get name and avatar (fallback to email/initial)
			const name = user.user_metadata?.name || user.email || 'User';
			const avatar = user.user_metadata?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=ffc107&color=222&bold=true`;
			// Fetch XP from Supabase
			let xp = await getUserXP(user.id);
			if (xp === null) xp = 0;
			userDiv.innerHTML = `
				<span class="badge rounded-pill bg-warning text-dark me-3 align-middle" style="font-size:1rem;vertical-align:middle;">${xp} XP</span>
				<div class="dropdown d-inline-block align-middle">
				  <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
					<img src="${avatar}" alt="avatar" width="32" height="32" class="rounded-circle me-2 border border-warning">
					<span class="fw-semibold">${name}</span>
				  </a>
				  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark" aria-labelledby="userDropdown" style="background: #151515">
					<li><a class="dropdown-item" href="#">Profile</a></li>
					<li><hr class="dropdown-divider"></li>
					<li><a class="dropdown-item" href="#" id="logoutBtn">Log out</a></li>
				  </ul>
				</div>
			`;
			// Add logout handler
			setTimeout(() => {
				const logoutBtn = document.getElementById('logoutBtn');
				if (logoutBtn) {
					logoutBtn.onclick = async function(e) {
						e.preventDefault();
						await sb.auth.signOut();
						localStorage.removeItem('sb-session');
						window.location.reload();
					};
				}
			}, 0);
		} else {
			// Not logged in: show login/signup
			userDiv.innerHTML = `
				<a href="/login.html" type="button" class="btn btn-outline-light me-2">Login</a>
				<a href="/signup.html" type="button" class="btn btn-warning">Sign-up</a>
			`;
		}
	}

	// On page load
	updateUserUI();
	</script>

	<script>
		(function() {
		const overlay = document.getElementById('bgOverlay');
		const bg = document.getElementById('bgImage');
		const header = document.querySelector('header');

		// how much scroll distance (px) to reach full black
		// change this to make fade faster/slower (e.g. 400 = faster, 1200 = slower)
		let fadeDistance = window.innerHeight * 0.9;

		function updateFadeDistance() {
			fadeDistance = window.innerHeight * 0.9;
		}

		// throttle using requestAnimationFrame for smoothness
		let ticking = false;
		function onScroll() {
			if (!ticking) {
				window.requestAnimationFrame(() => {
					const scrollY = window.scrollY || window.pageYOffset;
					// compute progress [0..1]
					let progress = Math.min(Math.max(scrollY / fadeDistance, 0), 1);
					// set overlay opacity
					overlay.style.opacity = progress.toFixed(3);
					// set header background opacity to match, with a cap for readability
					if (header) {
						const headerMax = 0.85;
						const alpha = Math.min(progress * headerMax, headerMax);
						header.style.backgroundColor = `rgba(0,0,0, ${alpha.toFixed(3)})`;
						// subtle shadow as it becomes opaque
						header.style.boxShadow = alpha > 0 ? `0 2px 12px rgba(0,0,0, ${Math.max(alpha * 0.6, 0.2).toFixed(3)})` : 'none';
						// optional slight blur once sufficiently opaque
						header.style.backdropFilter = alpha > 0.2 ? 'saturate(120%) blur(6px)' : 'saturate(120%) blur(0px)';
					}

					// small optional parallax transform for background image
					const parallax = Math.min(progress * 30, 30); // up to 30px shift
					bg.style.transform = `translateY(${parallax}px)`;

					ticking = false;
				});
				ticking = true;
			}
		}

		window.addEventListener('scroll', onScroll, { passive: true });
		window.addEventListener('resize', () => {
			updateFadeDistance();
			onScroll(); // recalc on resize
		});

		// initial call (if page isn't at top)
		onScroll();
		})();
	</script>

	<script>
	// Join counter + globe randomization
	(function() {
		const counterEl = document.getElementById('joinCounter');
		if (!counterEl) return;

		// Initialize number near a believable value
		let value = 12345 + Math.floor(Math.random() * 5000);

		function formatNumber(n) {
			return n.toLocaleString(undefined);
		}

		function tick() {
			// random small increment 1-20, with occasional surge
			let inc = 1 + Math.floor(Math.random() * 20);
			if (Math.random() < 0.08) inc += 100 + Math.floor(Math.random() * 200);
			value += inc;
			counterEl.textContent = formatNumber(value);
			// next tick between 0.6s and 2.2s
			const next = 600 + Math.random() * 1600;
			setTimeout(tick, next);
		}

		counterEl.textContent = formatNumber(value);
		setTimeout(tick, 1000);
	})();
	</script>

	<!-- Import map to resolve bare specifier 'three' for JSM loaders -->
	<script type="importmap">
	{
		"imports": {
			"three": "https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.module.js"
		}
	}
	</script>

	<script type="module">
	// Three.js globe setup (ES modules). Provide your GLB/GLTF path in modelUrl.
	import * as THREE from 'three';
	import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.159.0/examples/jsm/loaders/GLTFLoader.js';

	const mount = document.getElementById('globeMount');
	if (mount) {
		const modelUrl = '/globe.glb';
		const scene = new THREE.Scene();
		const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 100);
		camera.position.set(0, 0, 3);

		const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
		renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
		renderer.setSize(400, 400);
		mount.appendChild(renderer.domElement);

		// Lights
		const ambient = new THREE.AmbientLight(0xffffff, 0.8);
		scene.add(ambient);
		const dir = new THREE.DirectionalLight(0xffffff, 0.6);
		dir.position.set(3, 5, 2);
		scene.add(dir);

		let globe = null;
		const loader = new GLTFLoader();
		loader.load(modelUrl, (gltf) => {
			globe = gltf.scene;
			// Center and scale
			const box = new THREE.Box3().setFromObject(globe);
			const size = box.getSize(new THREE.Vector3()).length();
			const scale = 1.6 / size; // normalize size
			globe.scale.setScalar(scale * 2.1);
			box.setFromObject(globe);
			const center = box.getCenter(new THREE.Vector3());
			globe.position.sub(center);
			scene.add(globe);
		}, undefined, (err) => {
			console.warn('Failed to load globe model:', err);
		});

		// Responsive sizing based on mount width
		function resize() {
			const w = Math.min(mount.clientWidth || 400, 520);
			const h = w; // square canvas
			renderer.setSize(w, h);
			camera.aspect = w / h;
			camera.updateProjectionMatrix();
		}
		resize();
		window.addEventListener('resize', resize);

		// Random rotation direction and speed
		const dirSign = Math.random() > 0.5 ? 1 : -1;
		const baseSpeed = 0.003 + Math.random() * 0.004; // 0.003 - 0.007

		function animate() {
			requestAnimationFrame(animate);
			if (globe) {
				globe.rotation.y += dirSign * baseSpeed;
				globe.rotation.x = Math.sin(Date.now() * 0.0002) * 0.1; // gentle tilt
			}
			renderer.render(scene, camera);
		}
		animate();
	}
	</script>
</body>
</html>
